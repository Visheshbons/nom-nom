<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Nom Nom - Select Pickup Time">
    <meta name="keywords" content="cookies, brownies, lemonade, treats">
    <meta name="author" content="Nom Nom Team">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" href="styles.css">
    <link rel="shortcut icon" href="logo-photoroom.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Relief:wght@400;700&display=swap" rel="stylesheet">
    <title>Select Pickup Time | Nom Nom</title>
    <script src="https://www.google.com/recaptcha/api.js?render=<%= process.env.RECAPTCHA_SITE_KEY %>"></script>
</head>
<body>
    <%- include('header') %>
    <main class="top">
        <section>
            <h1>Select Pickup Time</h1>
            <p>Please choose when you'd like to pick up your order.</p>
        </section>

        <hr>

        <section class="time-slot-section">
            <div class="order-summary">
                <h2>Order Summary</h2>
                <div class="summary-details">
                    <p><strong>Item:</strong> <%= orderDetails.item %></p>
                    <p><strong>Quantity:</strong> <%= orderDetails.quantity %></p>
                    <p><strong>Customer:</strong> <%= orderDetails.customerName %></p>
                    <p><strong>Email:</strong> <%= orderDetails.customerEmail %></p>
                    <p><strong>Total:</strong> $<%= orderDetails.total.toFixed(2) %></p>
                </div>
            </div>

            <div class="time-slots-container">
                <h2>Available Pickup Times</h2>
                <p class="time-info">Market Day pickup times: 12:30 PM - 1:15 PM</p>

                <form action="/confirm-order" method="POST" id="timeSlotForm">
                    <div class="time-slots-grid">
                        <% for (let i = 0; i < timeSlots.length; i++) { %>
                            <% const slot = timeSlots[i]; %>
                            <% if (userBookedSlot) { %>
                                <% const isUserSlot = slot === userBookedSlot; %>
                                <label class="time-slot <%= isUserSlot ? 'your-slot' : 'unavailable' %>">
                                    <input
                                        type="radio"
                                        name="timeSlot"
                                        value="<%= slot %>"
                                        <%= !isUserSlot ? 'disabled' : '' %>
                                        <%= isUserSlot ? 'checked' : '' %>
                                        required
                                    >
                                    <span class="slot-time"><%= slot %> PM</span>
                                    <span class="slot-status">
                                        <%= isUserSlot ? 'Your Timeslot' : 'Unavailable' %>
                                    </span>
                                </label>
                            <% } else { %>
                                <% const isAvailable = availableSlots.includes(slot); %>
                                <label class="time-slot <%= isAvailable ? 'available' : 'booked' %>">
                                <input
                                    type="radio"
                                    name="timeSlot"
                                    value="<%= slot %>"
                                    <%= !isAvailable ? 'disabled' : '' %>
                                    required
                                >
                                <span class="slot-time"><%= slot %> PM</span>
                                <span class="slot-status">
                                    <%= isAvailable ? 'Available' : 'Booked' %>
                                </span>
                                </label>
                            <% } %>
                        <% } %>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" id="confirmBtn" disabled>Confirm Order</button>
                        <a href="/menu" class="cancel-btn">Back to Menu</a>
                    </div>

                    <input type="hidden" name="recaptchaToken" id="recaptchaToken">

                </form>
            </div>
        </section>

        <script>
          document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('timeSlotForm');
            const confirmBtn = document.getElementById('confirmBtn');
            const timeSlotInputs = document.querySelectorAll('input[name="timeSlot"]');

            // Enable button if slot already selected
            if ([...timeSlotInputs].some(i => i.checked)) {
              confirmBtn.disabled = false;
            }

            // Enable button on selection
            timeSlotInputs.forEach(input => {
              input.addEventListener('change', () => {
                confirmBtn.disabled = false;
              });
            });

            // Animate slots
            document.querySelectorAll('.time-slot').forEach((slot, i) => {
              setTimeout(() => {
                slot.style.opacity = '1';
                slot.style.transform = 'translateY(0)';
              }, i * 50);
            });

            // reCAPTCHA submit handling
            form.addEventListener('submit', async (e) => {
              e.preventDefault();

              confirmBtn.disabled = true; // prevent double submit

              const token = await grecaptcha.execute(
                '<%= process.env.RECAPTCHA_SITE_KEY %>',
                { action: 'confirm_order' }
              );

              document.getElementById('recaptchaToken').value = token;
              form.submit();
            });
          });
        </script>

    </main>
</body>
</html>


<!--====================
The Nom-Nom project is dedicated to:

* Krishh Grover, Muhammad Abdullah, and Logan Norman, as the fellow founders of Nom-Nom.
* I would also like to acknowledge Ian Harrison, for allowing me to make a website for our stall on Market Day 2025.
* e085d08ea02c10e8eb4f3ed507047b1fa9b31bdf1ac60c3d189d3b27c222fb8b9f884207e62c323b8dd8b095d8824ba6

There are a lot of people who have also helped, but I am too lazy to fit it all in a JS comment, but still, I appreciate it.

The Nom-Nom Project
Vishesh Kudva
=====================--->
